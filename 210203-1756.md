---
created: 2021-02-03 17:56
title: Architect
tags: :architect:
backlinks: [index](index.md)
type: text/x-markdown
description: 
---
## 基础点
### CAP原则 
CAP原则即分布式系统中, **C A P** 三个要素只能实现两个。
* **Consistence**:一致性. **所有节点获取数据一样**
* **Availability**: 可用性. **每次请求都能获取正确数据**
* **Partition tolerance**: 分区容错性, **以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况**
参考: [阮一峰CAP](http://www.ruanyifeng.com/blog/2018/07/cap.html)

### 分布式锁：
  **特点**
	1. 一个方法在一个时间只能一个线程使用。
	2. 高可用获取和释放锁。
	3. 高性能。
	4. 可重入机制。
	5. 锁失效机制，防止死锁。
	6. 非阻塞。

* redis单实例实现
```bash
SETNX keyName randomNum EXPIRE  // 每个线程生成一个randomNum
if get(key) == randomNum:  // 查看获得的key的名字
	delete keyName

* mysql实现

mysql table简历`unique key`，插入删除`unique-key` 实现.字段记录过期时间。

* zookeeper

> Apache 提供的zk客户端**curatorI**提供**InterProcessMutex**实现分布式锁（acquire、release）。

1. 创建lock**目录**。
2. 在lock目录下建**临时顺序节点**nodeX。
3. 查找有没有比nodeX序号小的节点，如果有则**监听**事件。
4. 当没比NodeX序号小的节点则表示获得锁。
5. 使用完成后删除nodeX。
